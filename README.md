# 地図表示サンプル (`test_map_leaflet.html`)

このリポジトリは、Webページ上に地図を表示するライブラリ`Leaflet.js`の基本的な使い方を学ぶためのサンプルです。

初学者が「地名や住所を元に地図上にマーカーをプロットする」というよくある課題に取り組む際のヒントとなることを目的としています。

## このプログラムの目的

`test_map_leaflet.html` は、ある地点（起点）と、検索したい地名を一つ指定すると、それらを地図上に表示する簡単なWebページです。

-   **機能1:** 指定した起点と検索した場所が収まるように、地図の表示範囲とズームレベルを自動的に調整します。
-   **機能2:** 場所の名前を元に、外部API（Nominatim）へ問い合わせて緯度経度を検索します。
-   **機能3:** 取得した緯度経度を元に、地図上にマーカーを配置し、クリックすると地名がポップアップで表示されるようにします。

## 使い方

特別なサーバーは必要ありません。`test_map_leaflet.html` ファイルをダブルクリックするか、お使いのWebブラウザで直接開いてください。

2つの地図が表示され、それぞれ「フィリピン」と「大坂」のマーカーがプロットされているのが確認できます。

## コードのポイント（課題を解くためのヒント）

このコードの挙動を理解することが、おそらくあなたの課題を解決する鍵となります。特に、`JavaScript`部分に注目してみましょう。

### 1. `createMap` 関数

地図の生成に関する処理は、すべて`createMap`という関数にまとめられています。

```javascript
function createMap(containerId, startPoint, placeName) {
    // ... 地図の初期化処理 ...
}
```

-   `containerId`: 地図を表示したいHTML要素のID（`map1` や `map2`）を受け取ります。
-   `startPoint`: 地図の初期表示の中心となる場所を**オブジェクト**で受け取ります。
-   `placeName`: マーカーを立てて表示したい場所の名前を**文字列**で受け取ります。

### 2. 場所の指定方法

スクリプトの最後で、この`createMap`関数を呼び出しています。

```javascript
// startPoint などの設定値は直前にまとめて定義
const startPoint = { name: "長野", center: [36.65, 138.19], zoom: 7 };

// 1 枚目のカード：起点は長野、検索先は「フィリピン」
createMap("map1", startPoint, "フィリピン");

// 2 枚目のカード：同じ起点で別の地名「大坂」を検索
createMap("map2", startPoint, "大坂");
```

`startPoint`引数には `{ name: "長野", center: [緯度, 経度], zoom: ズームレベル }` のようなオブジェクトを渡していることに注目してください。

-   **`startPoint` (第2引数):** 地図の初期表示の中心とズームレベルを決定します。このサンプルの場合、「長野」が中心になります。
-   **`placeName` (第3引数):** `"フィリピン"` や `"大坂"` といった、実際にマーカーを立てたい場所の名前です。

### 3. シンプルになったルール

このサンプルの`createMap`関数は、以前のバージョンよりもシンプルなルールで動作します。

-   **`startPoint`** は、地図の初期表示と、**地図の表示範囲を決めるため**に使われます。マーカーは表示されません。
-   **`placeName`** で指定された地名がジオコーディング（緯度経度検索）され、成功した場合に**マーカーが表示されます。**

コードの中では、`addPlace` という内部関数がその処理を担当しています。

```javascript
// ...
// 起点座標を記録して表示範囲の基準を作る
bounds.push(startPoint.center);

if (placeName) {
    // 地名が指定されている場合だけジオコーディングを行う
    const latLng = await geocode(placeName); // [緯度, 経度]
    if (latLng) {
        bounds.push(latLng);
        // マーカーで取得地点を視覚的に示す
        const marker = L.marker(latLng).addTo(map);
        marker.bindPopup(`<strong>${placeName}</strong>`);
    }
}

if (bounds.length > 1) {
    // 複数地点が集まった場合は自動的に表示範囲を調整
    map.fitBounds(bounds, { padding: [50, 50] });
}
// ...
```

このサンプルでは「長野」(`startPoint`)と「フィリピン」(`placeName`)の両方が見えるように地図の範囲が計算されますが、マーカーが立つのは「フィリピン」だけです。

もし、あなたが取り組んでいる課題が「指定したすべての場所にマーカーを立てたい」というものであれば、どうすれば`startPoint`の場所にもマーカーを立てられるか、あるいは`placeName`のような引数を複数受け取れるようにするにはどうすればよいか、などを考えてみると良いでしょう。

---

このサンプルコードが、あなたの学習の助けになれば幸いです。

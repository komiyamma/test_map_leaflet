<!doctype html>
<!-- ブラウザーを標準モードで動作させるために DOCTYPE を明示 -->
<html lang="ja">

    <head>
        <meta charset="utf-8" />
        <!-- タブの表示名をすっきりさせるため短いタイトルを設定 -->
        <title>マップ</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <!-- Leaflet 公式 CDN からスタイルシートを読み込む -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
        <link rel="stylesheet" href="./mapStyles.css" />
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>
        <script src="./mapHelpers.js" defer></script>
    </head>

    <body>
        <!-- 地図カードを束ねるラッパー要素 -->
        <div id="wrap">
            <!-- 地図カードの本体ここから -->
            <div class="card">
                <div class="card-header"></div>
                <div id="map1" class="map"></div>
            </div>
            <!-- 比較用にもう一枚地図カードを配置 -->
            <div class="card">
                <div class="card-header"></div>
                <div id="map2" class="map"></div>
            </div>
        </div>

        <!-- クレジットを全幅で載せるためラッパーの外に配置 -->
        <div class="site-footer">
            <!-- クレジット表記を控えめに示すため小さな文字を使用 -->
            <small>
                地図データ提供：<a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">© OpenStreetMap contributors</a>
            </small>
        </div>


        <!-- このページ用スクリプトでジオコーディングと Leaflet を連携 -->
        <script>
            /*
             * このスクリプトは Leaflet で地図カードを初期化し、
             * OpenStreetMap タイルと Nominatim の検索結果を組み合わせて表示する。
             * ここでは最低限の初期設定だけをまとめ、細かな処理は関数ごとに切り分けている。
             */

            // カード見出しを設定する補助関数（教材向けにあえて簡潔な作り）
            function setCardHeader(containerId, titleText) {
                // containerId はこのファイル内で完結する前提なので信頼して扱う
                const mapEl = document.getElementById(containerId);
                // 直接 DOM を参照して余計な依存を持たせない
                if (!mapEl) return;
                // 対象要素が無いときは静かに抜けてコンソールを汚さない
                const headerEl = mapEl.previousElementSibling;
                // カード構造上ヘッダーは地図要素の直前にある想定
                if (!headerEl || !headerEl.classList.contains('card-header')) return;
                // 想定外にマークアップが入れ替わった場合に備えて処理を打ち切る
                headerEl.textContent = titleText || '';
                // 空文字を入れて "undefined" や "null" が表示されるのを防ぐ
            }



            // カード UI と地図生成を束ねる薄いファサード。
            // ヘッダーを整えてから createMap に処理を委譲する。
            function setCardMap(containerId, headerText, startPoint, placeName) {
                setCardHeader(containerId, headerText);
                return createMap(containerId, startPoint, placeName);
            }

            window.addEventListener("DOMContentLoaded", () => {
                // startPoint などの設定値は DOM 構築後に定義
                const startPoint = { name: "長野", center: [36.65, 138.19], zoom: 7 };

                // 1 枚目のカード：起点は STARTPOINT、検索先のみマーカーを表示
                setCardMap("map1", "フィリピン", startPoint, "フィリピン");

                // 2 枚目のカード：同じ起点で別の地名を検索表示
                setCardMap("map2", "大坂", startPoint, "大坂");
            });
        </script>
        <!-- 必要最低限のマークアップ構成で body を閉じる -->
    </body>

<!-- html タグを閉じて文書全体を整える -->
</html>













<!doctype html>
<html lang="ja">

    <head>
        <meta charset="utf-8" />
        <title>マップ</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
        <style>
            html, body {
                height: 100%;
                margin: 0;
            }

            /* ラッパー（横並び、必要なら折り返し） */
            #wrap {
                display: flex;
                flex-wrap: wrap;
                gap: 12px;
                padding: 12px;
                align-items: flex-start;
            }

            /* とても簡素なカード */
            .card {
                width: 300px;
                height: 400px;
                border: 1px solid #ddd;
                border-radius: 4px;
                background: #fff;
                display: flex;
                flex-direction: column;
            }

            .card-header {
                padding: 8px 10px;
                font-size: 14px;
                border-bottom: 1px solid #eee;
            }

            .card-footer {
                padding: 6px 8px;
                font-size: 12px;
                border-top: 1px solid #eee;
                color: #666;
            }

            /* ページ下部に1箇所だけ出す簡易クレジット */
            .site-footer {
                padding: 8px 12px;
                font-size: 12px;
                color: #666;
                border-top: 1px solid #eee;
            }

            /* マップ領域はカードの残りを占有 */
            .map {
                flex: 1 1 auto;
                min-height: 0; /* Flex 子要素の高さ計算を正しくするため */
            }
        </style>
    </head>

    <body>
        <div id="wrap">
            <div class="card">
                <div class="card-header"></div>
                <div id="map1" class="map"></div>
            </div>
            <div class="card">
                <div class="card-header"></div>
                <div id="map2" class="map"></div>
            </div>
        </div>

        <div class="site-footer">
            <small>
                地図データ提供：<a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">© OpenStreetMap contributors</a>
            </small>
        </div>

        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

        <script>
            /*
             * このスクリプトは Leaflet を利用して地図を初期化し、
             * OpenStreetMap タイルを貼り付けた上で Nominatim API によるジオコーディング結果を
             * プロットする一連の流れを実現している。
             * 処理の骨子とデータの流れが把握しやすいよう、病的なほど詳細なコメントで
             * 各行・各ブロックが担う役割を明記している。
             */

            // カード見出しを設定するヘルパー（初心者向けにシンプルな関数として定義）
            function setCardHeader(containerId, titleText) {
                const mapEl = document.getElementById(containerId);
                if (!mapEl) return;
                const headerEl = mapEl.previousElementSibling;
                if (!headerEl || !headerEl.classList.contains('card-header')) return;
                headerEl.textContent = titleText || '';
            }

            // 使い回し用の簡単なジオコーディング関数（見つからなければ null を返す）
            async function geocode(placeName) {
                const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(placeName)}&limit=1`;
                const res = await fetch(url, { headers: { "Accept-Language": "ja" } });
                const data = await res.json();
                if (data && data.length > 0) {
                    const loc = data[0];
                    return [parseFloat(loc.lat), parseFloat(loc.lon)];
                }
                return null;
            }

            function createMap(containerId, startPoint, placeName) {
                const map = L.map(containerId, { attributionControl: false }).setView(startPoint.center, startPoint.zoom);
                L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 18 }).addTo(map);

                const bounds = [];

                // Configure the title shown in the card header
                const titleText = placeName;
                setCardHeader(containerId, titleText);

                async function addPlace() {
                    bounds.push(startPoint.center);

                    if (placeName) {
                        const latLng = await geocode(placeName); // [lat, lon]
                        if (latLng) {
                            bounds.push(latLng);
                            const marker = L.marker(latLng).addTo(map);
                            marker.bindPopup(`<strong>${placeName}</strong>`);
                        }
                    }

                    if (bounds.length > 1) {
                        map.fitBounds(bounds, { padding: [50, 50] });
                    } else {
                        map.setView(startPoint.center, startPoint.zoom);
                    }
                }

                addPlace();
                return map;
            }

            // 設定は呼び出し直前にまとめる（STARTPOINT など）
            const startPoint = { name: "長野", center: [36.65, 138.19], zoom: 7 };

            // 1枚目（起点は STARTPOINT、起点はマーカー無し）
            createMap("map1", startPoint, "フィリピン");

            // 2枚目（起点は STARTPOINT、起点はマーカー無し）
            createMap("map2", startPoint, "大坂");
        </script>
    </body>

</html>







